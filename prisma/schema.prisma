generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id String @id @default(uuid()) @db.Uuid
  email String  @unique
  password String
  name String?
  avatar_url String?
  role String @default("user")
  is_verified Boolean @default(false)
  is_active Boolean @default(true)
  created_at DateTime? @default(now()) @db.Timestamptz
  updated_at DateTime? @updatedAt() @db.Timestamptz
  last_login_at DateTime? @db.Timestamptz 

  // Relations
  accounts            Account[]
  refresh_tokens      RefreshToken[]
  email_verifications EmailVerification[]
  
  @@index([id, email])
  @@map("users")
}

model RefreshToken {
  id String @id @default(uuid()) @db.Uuid
  user_id String @db.Uuid
  token_hash String @unique
  is_revoked Boolean @default(false)
  revoked_date DateTime? @db.Timestamptz
  expires_at DateTime @db.Timestamptz
  created_at DateTime @default(now()) @db.Timestamptz
  
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id, token_hash, is_revoked])
  @@map("refresh_tokens")
}

model Account {
  id String @id @default(uuid()) @db.Uuid
  user_id String @db.Uuid
  provider String 
  provider_account_id String @unique
  created_at DateTime? @default(now()) @db.Timestamptz

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([id, user_id])
  @@map("accounts")
}

model EmailVerification {
  id String @id @default(uuid()) @db.Uuid
  user_id String @db.Uuid
  tokem String
  expires_at DateTime @db.Timestamptz

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([id, user_id])
  @@map("email_verifications")
}
