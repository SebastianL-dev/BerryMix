generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id String @id @default(uuid()) @db.Uuid
  email String  @unique
  password_hash String
  name String?
  avatar_url String?
  role String @default("user")
  is_verified Boolean @default(false)
  is_active Boolean @default(true)
  created_at DateTime? @default(now())
  updated_at DateTime? @updatedAt()
  last_login_at DateTime? 

  // Relations
  accounts            Account[]
  refresh_tokens      RefreshToken[]
  email_verifications EmailVerification[]
  
  @@map("users")
}

model Account {
  id String @id @default(uuid()) @db.Uuid
  user_id String @db.Uuid
  provider String 
  provider_account_id String @unique
  created_at DateTime? @default(now())

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([id, user_id])
  @@map("accounts")
}

model RefreshToken {
  id String @id @default(uuid()) @db.Uuid
  user_id String @db.Uuid
  token_hash String 
  expires_at DateTime
  revoked_at DateTime?
  created_at DateTime
  
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([id, user_id])
  @@map("refresh_tokens")
}

model EmailVerification {
  id String @id @default(uuid()) @db.Uuid
  user_id String @db.Uuid
  tokem String
  expires_at DateTime

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([id, user_id])
  @@map("email_verifications")
}
